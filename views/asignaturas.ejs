<%- include('partials/_header.ejs') %> <!-- Incluye el header -->

<div class="container mt-4">
    <div class="row">
        <% if (user.rol === "administrador") { %>
        <!-- Sección para agregar asignatura -->
        <div class="col-md-5">
            <div class="card shadow-lg border-primary">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Añadir Nueva Asignatura</h5>
                </div>
                <div class="card-body">
                    <form action="/asignatura/add" method="post">
                        <div class="mb-3">
                            <label for="nombre" class="form-label">Nombre:</label>
                            <input type="text" class="form-control" id="nombre" name="nombre" required>
                        </div>
                        <div class="mb-3">
                            <label for="curso" class="form-label">Curso:</label>
                            <input type="text" class="form-control" id="curso" name="curso" required>
                        </div>

                        <!-- Selección de Alumnos -->
                        <div class="mb-3">
                            <label for="alumnos" class="form-label">Alumnos:</label>
                            <select class="form-select" id="alumnos" name="alumnos" multiple>
                                <% alumnos.forEach(alumno => { %>
                                <option value="<%= alumno._id %>"><%= alumno.nombre %> <%= alumno.apellido %></option>
                                <% }) %>
                            </select>
                            <small class="text-muted">Selecciona múltiples alumnos (Ctrl + Click)</small>
                        </div>

                        <!-- Selección de Profesores -->
                        <div class="mb-3">
                            <label for="profesores" class="form-label">Profesores:</label>
                            <select class="form-select" id="profesores" name="profesores" multiple>
                                <% profesores.forEach(profesor => { %>
                                <option value="<%= profesor._id %>"><%= profesor.nombre %> <%= profesor.apellido %></option>
                                <% }) %>
                            </select>
                        </div>

                        <!-- Selección de Estudio -->
                        <div class="mb-3">
                            <label for="estudio" class="form-label">Estudio:</label>
                            <select class="form-select" id="estudio" name="estudio" required>
                                <% estudios.forEach(estudio => { %>
                                <option value="<%= estudio._id %>"><%= estudio.nombre %> (<%= estudio.tipo %>)</option>
                                <% }) %>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-success w-100">
                            <i class="fas fa-plus-circle"></i> Añadir Asignatura
                        </button>
                    </form>
                </div>
            </div>
        </div>
        <% } %>

        <div class="col-md-7">
          <div class="card shadow-lg border-secondary">
              <div class="card-header bg-secondary text-white">
                  <h5 class="mb-0">Listado de Asignaturas</h5>
              </div>
              <div class="card-body">
                  <div class="table-responsive">
                      <table class="table table-striped table-hover align-middle">
                          <thead class="table-dark">
                              <tr>
                                  <th class="text-center">N°</th>
                                  <th>Nombre</th>
                                  <th class="text-center">Curso</th>
                                  <th class="text-center">Profesores</th>
                                  <th class="text-center">Alumnos</th>
                                  <th class="text-center">Estudio</th>
                                  <th class="text-center">Operación</th>
                              </tr>
                          </thead>
                          <tbody>
                              <% for(var i = 0; i < asignaturas.length; i++) { %>
                              <tr>
                                  <td class="text-center"><%= i + 1 %></td>
                                  <td class="fw-bold">
                                    <a href="/software/<%= asignaturas[i]._id %>">
                                    <%= asignaturas[i].nombre %>
                                  </td>
                                  <td class="text-center"><%= asignaturas[i].curso %></td>
      
                                  <!-- Profesores -->
                                  <td class="text-center">
                                      <div class="d-flex flex-wrap gap-1 justify-content-center">
                                          <% profesores.forEach(profesor => { %>
                                              <% if (asignaturas[i].profesores.includes(profesor._id.toString())) { %>
                                                  <span class="badge bg-primary px-2 py-1"><%= profesor.nombre %></span>
                                              <% } %>
                                          <% }) %>
                                      </div>
                                  </td>
      
                                  <!-- Alumnos -->
                                  <td class="text-center">
                                      <div class="d-flex flex-wrap gap-1 justify-content-center">
                                          <% alumnos.forEach(alumno => { %>
                                              <% if (asignaturas[i].alumnos.includes(alumno._id.toString())) { %>
                                                  <span class="badge bg-info px-2 py-1"><%= alumno.nombre %></span>
                                              <% } %>
                                          <% }) %>
                                      </div>
                                  </td>
      
                                  <!-- Estudio -->
                                  <td class="text-center">
                                      <% estudios.forEach(estudio => { %>
                                          <% if (asignaturas[i].estudio.toString() === estudio._id.toString()) { %>
                                              <span class="badge bg-warning px-2 py-1"><%= estudio.nombre %> (<%= estudio.tipo %>)</span>
                                          <% } %>
                                      <% }) %>
                                  </td>
      
                                  <!-- Botones de acciones -->
                                  <td class="text-center">
                                      <a href="/asignaturas/delete/<%= asignaturas[i]._id %>" class="btn btn-sm btn-danger px-3">
                                          <i class="fas fa-trash-alt"></i> Eliminar
                                      </a>
                                      <a href="/asignaturas/editAsignatura/<%= asignaturas[i]._id %>" class="btn btn-sm btn-info px-3">
                                          <i class="fas fa-edit"></i> Editar
                                      </a>
                                  </td>
                              </tr>
                              <% } %>
                          </tbody>
                      </table>
                  </div>
              </div>
          </div>
      </div>
      
    </div>
</div>

<%- include('partials/_footer.ejs') %> <!-- Incluye el footer -->
